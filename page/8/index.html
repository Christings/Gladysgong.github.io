<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"gongyanli.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Up in the wind!">
<meta property="og:type" content="website">
<meta property="og:title" content="茉莉Python">
<meta property="og:url" content="http://gongyanli.com/page/8/index.html">
<meta property="og:site_name" content="茉莉Python">
<meta property="og:description" content="Up in the wind!">
<meta property="og:locale">
<meta property="article:author" content="Lilly">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://gongyanli.com/page/8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>茉莉Python</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">茉莉Python</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">voidqueens@hotmail.com</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://gongyanli.com/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92-%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lilly">
      <meta itemprop="description" content="Up in the wind!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茉莉Python">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92-%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">线性回归--从0开始实现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-09-17 19:19:43" itemprop="dateCreated datePublished" datetime="2018-09-17T19:19:43+08:00">2018-09-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-18 17:10:52" itemprop="dateModified" datetime="2020-09-18T17:10:52+08:00">2020-09-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">机器学习和深度学习</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/gluon/" itemprop="url" rel="index"><span itemprop="name">gluon</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>代码：<a target="_blank" rel="noopener" href="https://github.com/Gladysgong/gluon_learning/blob/master/chap3_basic/">https://github.com/Gladysgong/gluon_learning/blob/master/chap3_basic/</a></p>
<h2 id="一-线性回归"><a href="#一-线性回归" class="headerlink" title="一.线性回归"></a>一.线性回归</h2><pre><code>线性回归输出是连续值，因此不适用于回归问题；
Softmax回归输出是是离散值，因为适用于分类问题。</code></pre>
<h3 id="1-线性回归要素"><a href="#1-线性回归要素" class="headerlink" title="1.线性回归要素"></a>1.线性回归要素</h3><pre><code>模型: 
    表达式：</code></pre>
<p>$$\hat{y} = x_1 w_1 + x_2 w_2 + b,$$</p>
<pre><code>    模型训练:
        训练数据
        损失函数
        优化算法:
            解析解：误差最小化问题的解可以直接用公式表达出来
            数值解：大多数深度学习模型并没有解析解，只能通过优化算法有限次迭代模型参数来尽可能降低损失函数的值
                   小批量随机梯度下降：批量大小和学习率是认为设定的，叫做超参数

    模型预测</code></pre>
<h3 id="2-线性回归表示方法"><a href="#2-线性回归表示方法" class="headerlink" title="2.线性回归表示方法"></a>2.线性回归表示方法</h3><pre><code>神经网络图
矢量计算表达式</code></pre>
<h2 id="二-线性回归–从0开始实现"><a href="#二-线性回归–从0开始实现" class="headerlink" title="二.线性回归–从0开始实现"></a>二.线性回归–从0开始实现</h2><pre class=" language-python"><code class="language-python"><span class="token operator">%</span>matplotlib inline
<span class="token keyword">from</span> IPython <span class="token keyword">import</span> display
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> mxnet <span class="token keyword">import</span> autograd<span class="token punctuation">,</span> nd
<span class="token keyword">import</span> random</code></pre>
<h3 id="1-生成数据集"><a href="#1-生成数据集" class="headerlink" title="1.生成数据集"></a>1.生成数据集</h3><pre><code>numpy.random.normal(loc=0.0, scale=1.0, size=None)11
loc：float
    此概率分布的均值（对应着整个分布的中心centre）
scale：float
    此概率分布的标准差（对应于分布的宽度，scale越大越矮胖，scale越小，越瘦高）
size：int or tuple of ints
    输出的shape，默认为None</code></pre>
<pre class=" language-python"><code class="language-python">num_inputs<span class="token operator">=</span><span class="token number">2</span>
num_examples<span class="token operator">=</span><span class="token number">1000</span>
true_w<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3.4</span><span class="token punctuation">]</span>
true_b<span class="token operator">=</span><span class="token number">4.2</span>
features<span class="token operator">=</span>nd<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span>scale<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>shape<span class="token operator">=</span><span class="token punctuation">(</span>num_examples<span class="token punctuation">,</span>num_inputs<span class="token punctuation">)</span><span class="token punctuation">)</span>
labels<span class="token operator">=</span>true_w<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span>features<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>true_w<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span>features<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>true_b
labels<span class="token operator">+=</span>nd<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span>scale<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span>shape<span class="token operator">=</span>labels<span class="token punctuation">.</span>shape<span class="token punctuation">)</span></code></pre>
<pre class=" language-python"><code class="language-python">features<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>labels<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></code></pre>
<pre><code>(
 [ 1.16307867  0.48380461]
 &lt;NDArray 2 @cpu(0)&gt;, 
 [ 4.87962484]
 &lt;NDArray 1 @cpu(0)&gt;)</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">use_svg_display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># 用矢量图表示</span>
    display<span class="token punctuation">.</span>set_matplotlib_formats<span class="token punctuation">(</span><span class="token string">'svg'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">set_figsize</span><span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3.5</span><span class="token punctuation">,</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#set_matplotlib_formats('svg')</span>
    use_svg_display<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># 设置图的尺寸</span>
    plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'figure.figsize'</span><span class="token punctuation">]</span><span class="token operator">=</span>figsize

set_figsize<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>features<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>asnumpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>labels<span class="token punctuation">.</span>asnumpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># plt.show()</span></code></pre>
<pre><code>&lt;matplotlib.collections.PathCollection at 0x117cadda0&gt;</code></pre>
<p><img src="/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92-%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0/linear_regression_6_1.svg" alt="svg"></p>
<h3 id="2-读取数据"><a href="#2-读取数据" class="headerlink" title="2.读取数据"></a>2.读取数据</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 每次返回batch_size(批量大小)个随机样本的特征和标签</span>
<span class="token comment" spellcheck="true"># 此函数已保存在gluonbook包中方便以后使用</span>
<span class="token keyword">def</span> <span class="token function">data_iter</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span>features<span class="token punctuation">,</span>labels<span class="token punctuation">)</span><span class="token punctuation">:</span>
    num_examples<span class="token operator">=</span>len<span class="token punctuation">(</span>features<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"长度："</span><span class="token punctuation">,</span>num_examples<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 1000,行数</span>
    indices<span class="token operator">=</span>list<span class="token punctuation">(</span>range<span class="token punctuation">(</span>num_examples<span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token comment" spellcheck="true">#     print("indices：",indices)  # 0-999</span>
    random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>indices<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 样本的读取顺序是随机的。</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>num_examples<span class="token punctuation">,</span>batch_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        j<span class="token operator">=</span>nd<span class="token punctuation">.</span>array<span class="token punctuation">(</span>indices<span class="token punctuation">[</span>i<span class="token punctuation">:</span>min<span class="token punctuation">(</span>i<span class="token operator">+</span>batch_size<span class="token punctuation">,</span>num_examples<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">yield</span> features<span class="token punctuation">.</span>take<span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>labels<span class="token punctuation">.</span>take<span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># take 函数根据索引返回对应元素。</span></code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 每个批量的特征形状为（10， 2），分别对应批量大小和输入个数；标签形状为批量大小。</span>
batch_size <span class="token operator">=</span> <span class="token number">10</span>

<span class="token keyword">for</span> X<span class="token punctuation">,</span> y <span class="token keyword">in</span> data_iter<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> features<span class="token punctuation">,</span> labels<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    <span class="token keyword">break</span></code></pre>
<pre><code>长度： 1000

[[-1.4370029  -2.39830184]
 [ 0.86399084 -0.95994246]
 [-1.49929214  1.21278656]
 [ 2.52268934 -0.37837121]
 [ 1.39448225  0.56141484]
 [ 0.50767344  0.07797763]
 [ 0.37963197 -0.65589839]
 [-0.47827247 -1.17394924]
 [-0.11860342  1.41482413]
 [ 1.18384051  0.65427899]]
&lt;NDArray 10x2 @cpu(0)&gt; 
[  9.47776413   9.20563984  -2.91862679  10.52518559   5.09047413
   4.9430213    7.19049788   7.2272377   -0.82722223   4.32375574]
&lt;NDArray 10 @cpu(0)&gt;</code></pre>
<h3 id="3-初始化模型参数"><a href="#3-初始化模型参数" class="headerlink" title="3.初始化模型参数"></a>3.初始化模型参数</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 将权重初始化成均值为 0 标准差为 0.01 的正态随机数，偏差则初始化成 0。</span>
w<span class="token operator">=</span>nd<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span>scale<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">,</span>shape<span class="token operator">=</span><span class="token punctuation">(</span>num_inputs<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
b<span class="token operator">=</span>nd<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre class=" language-python"><code class="language-python">w<span class="token punctuation">,</span>b</code></pre>
<pre><code>(
 [[ 0.01464221]
  [-0.01305814]]
 &lt;NDArray 2x1 @cpu(0)&gt;, 
 [ 0.]
 &lt;NDArray 1 @cpu(0)&gt;)</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 创建梯度，yinw需要对这些参数求梯度来迭代参数的值</span>
w<span class="token punctuation">.</span>attach_grad<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 申请存储梯度所需要的内存</span>
b<span class="token punctuation">.</span>attach_grad<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<h3 id="4-定义模型"><a href="#4-定义模型" class="headerlink" title="4.定义模型"></a>4.定义模型</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 线性回归的矢量计算表达式的实现</span>
<span class="token comment" spellcheck="true"># 本函数已保存在 gluonbook 包中方便以后使用。</span>
<span class="token keyword">def</span> <span class="token function">linreg</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span>w<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> nd<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>X<span class="token punctuation">,</span>w<span class="token punctuation">)</span><span class="token operator">+</span>b <span class="token comment" spellcheck="true"># dot做矩阵乘法</span></code></pre>
<h3 id="5-定义损失函数"><a href="#5-定义损失函数" class="headerlink" title="5.定义损失函数"></a>5.定义损失函数</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 使用平方损失来定义线性回归的损失函数</span>
<span class="token comment" spellcheck="true"># 本函数已保存在 gluonbook 包中方便以后使用。</span>
<span class="token keyword">def</span> <span class="token function">squared_loss</span><span class="token punctuation">(</span>y_hat<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span><span class="token punctuation">(</span>y_hat<span class="token operator">-</span>y<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>y_hat<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token operator">/</span><span class="token number">2</span> <span class="token comment" spellcheck="true"># y_hat是线性回归对真实价格 y 的预测或估计</span></code></pre>
<h3 id="6-定义优化算法"><a href="#6-定义优化算法" class="headerlink" title="6.定义优化算法"></a>6.定义优化算法</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 使用sgd函数实现小批量随机梯度下降算法</span>
<span class="token comment" spellcheck="true"># 通过不断迭代模型参数来优化损失函数，这里自动求导模块计算得来的梯度是一个批量样本的梯度和，将它除以批量大小来得到平均值。</span>
<span class="token comment" spellcheck="true"># 本函数已保存在 gluonbook 包中方便以后使用。</span>
<span class="token keyword">def</span> <span class="token function">sgd</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span>lr<span class="token punctuation">,</span>batch_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> param <span class="token keyword">in</span> params<span class="token punctuation">:</span>
        param<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">=</span>param<span class="token operator">-</span>lr<span class="token operator">*</span>param<span class="token punctuation">.</span>grad<span class="token operator">/</span>batch_size</code></pre>
<h3 id="7-训练模型"><a href="#7-训练模型" class="headerlink" title="7.训练模型"></a>7.训练模型</h3><pre class=" language-python"><code class="language-python">lr <span class="token operator">=</span> <span class="token number">0.03</span>
num_epochs <span class="token operator">=</span> <span class="token number">3</span>
net <span class="token operator">=</span> linreg
loss <span class="token operator">=</span> squared_loss

<span class="token keyword">for</span> epoch <span class="token keyword">in</span> range<span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># 训练模型一共需要 num_epochs 个迭代周期。</span>
    <span class="token comment" spellcheck="true"># 在一个迭代周期中，使用训练数据集中所有样本一次（假设样本数能够被批量大小整除）。</span>
    <span class="token comment" spellcheck="true"># X 和 y 分别是小批量样本的特征和标签。</span>
    <span class="token keyword">for</span> X<span class="token punctuation">,</span> y <span class="token keyword">in</span> data_iter<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> features<span class="token punctuation">,</span> labels<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> autograd<span class="token punctuation">.</span>record<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            l <span class="token operator">=</span> loss<span class="token punctuation">(</span>net<span class="token punctuation">(</span>X<span class="token punctuation">,</span> w<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># l 是有关小批量 X 和 y 的损失。</span>
        l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 小批量的损失对模型参数求梯度。</span>
        sgd<span class="token punctuation">(</span><span class="token punctuation">[</span>w<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">,</span> lr<span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 使用小批量随机梯度下降迭代模型参数。</span>
    train_l <span class="token operator">=</span> loss<span class="token punctuation">(</span>net<span class="token punctuation">(</span>features<span class="token punctuation">,</span> w<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> labels<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'epoch %d, loss %f'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> train_l<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>asnumpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre><code>长度： 1000
epoch 1, loss 0.000048
长度： 1000
epoch 2, loss 0.000048
长度： 1000
epoch 3, loss 0.000048</code></pre>
<pre class=" language-python"><code class="language-python">true_w<span class="token punctuation">,</span>w</code></pre>
<pre><code>([2, -3.4], 
 [[ 2.00003362]
  [-3.40025949]]
 &lt;NDArray 2x1 @cpu(0)&gt;)</code></pre>
<pre class=" language-python"><code class="language-python">true_b<span class="token punctuation">,</span>b</code></pre>
<pre><code>(4.2, 
 [ 4.20015049]
 &lt;NDArray 1 @cpu(0)&gt;)</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://gongyanli.com/KNN/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lilly">
      <meta itemprop="description" content="Up in the wind!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茉莉Python">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/KNN/" class="post-title-link" itemprop="url">KNN</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-09-10 14:26:36" itemprop="dateCreated datePublished" datetime="2018-09-10T14:26:36+08:00">2018-09-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-18 16:59:41" itemprop="dateModified" datetime="2020-09-18T16:59:41+08:00">2020-09-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">机器学习和深度学习</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E3%80%8A%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98%E3%80%8B/" itemprop="url" rel="index"><span itemprop="name">《机器学习实战》</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#coding:utf-8</span>

<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> operator</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">createDataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    group<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    labels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> group<span class="token punctuation">,</span>labels</code></pre>
<pre class=" language-python"><code class="language-python">group<span class="token punctuation">,</span>labels<span class="token operator">=</span>createDataSet<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre class=" language-python"><code class="language-python">group<span class="token punctuation">,</span>labels</code></pre>
<pre><code>(array([[1. , 1.1],
        [1. , 1. ],
        [0. , 0. ],
        [0. , 0.1]]), [&#39;A&#39;, &#39;A&#39;, &#39;B&#39;, &#39;B&#39;])</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">classify0</span><span class="token punctuation">(</span>inX<span class="token punctuation">,</span>dataSet<span class="token punctuation">,</span>labels<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>
    dataSetSize<span class="token operator">=</span>dataSet<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># dataSet的行数</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"dataSetSize:"</span><span class="token punctuation">,</span>dataSetSize<span class="token punctuation">)</span>
    diffMat<span class="token operator">=</span>np<span class="token punctuation">.</span>tile<span class="token punctuation">(</span>inX<span class="token punctuation">,</span><span class="token punctuation">(</span>dataSetSize<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span>dataSet <span class="token comment" spellcheck="true"># 构造一个和dataSet一样的矩阵，再和dataSet相减</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"diffMat:"</span><span class="token punctuation">,</span>diffMat<span class="token punctuation">)</span>
    sqDiffMat<span class="token operator">=</span>diffMat<span class="token operator">**</span><span class="token number">2</span> <span class="token comment" spellcheck="true"># 矩阵的平方</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"sqDiffMat:"</span><span class="token punctuation">,</span>sqDiffMat<span class="token punctuation">)</span>
    sqDistances<span class="token operator">=</span>sqDiffMat<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 按行相加</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"sqDistances:"</span><span class="token punctuation">,</span>sqDistances<span class="token punctuation">)</span>
    distances<span class="token operator">=</span>sqDistances<span class="token operator">**</span><span class="token number">0.5</span> <span class="token comment" spellcheck="true"># 开方，求距离</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"distances:"</span><span class="token punctuation">,</span>distances<span class="token punctuation">)</span>
    sortedDistIndicies<span class="token operator">=</span>distances<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 对距离排序</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"sortedDistIndicies:"</span><span class="token punctuation">,</span>sortedDistIndicies<span class="token punctuation">)</span>
    classCount<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;&amp;#125;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>
        voteIlabel<span class="token operator">=</span>labels<span class="token punctuation">[</span>sortedDistIndicies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"voteIlable:"</span><span class="token punctuation">,</span>voteIlabel<span class="token punctuation">)</span>
        classCount<span class="token punctuation">[</span>voteIlabel<span class="token punctuation">]</span><span class="token operator">=</span>classCount<span class="token punctuation">.</span>get<span class="token punctuation">(</span>voteIlabel<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"classCount:"</span><span class="token punctuation">,</span>classCount<span class="token punctuation">)</span>
    sortedClassCount<span class="token operator">=</span>sorted<span class="token punctuation">(</span>classCount<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>key<span class="token operator">=</span>operator<span class="token punctuation">.</span>itemgetter<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>sortedClassCount<span class="token punctuation">)</span>
    <span class="token keyword">return</span> sortedClassCount<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
classify0<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">1.2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>group<span class="token punctuation">,</span>labels<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span></code></pre>
<pre><code>dataSetSize: 4
diffMat: [[0.  0.1]
 [0.  0.2]
 [1.  1.2]
 [1.  1.1]]
sqDiffMat: [[0.   0.01]
 [0.   0.04]
 [1.   1.44]
 [1.   1.21]]
sqDistances: [0.01 0.04 2.44 2.21]
distances: [0.1        0.2        1.56204994 1.48660687]
sortedDistIndicies: [0 1 3 2]
voteIlable: A
classCount: &#123;&#39;A&#39;: 1&#125;
voteIlable: A
classCount: &#123;&#39;A&#39;: 2&#125;
voteIlable: B
classCount: &#123;&#39;A&#39;: 2, &#39;B&#39;: 1&#125;
[(&#39;A&#39;, 2), (&#39;B&#39;, 1)]





&#39;A&#39;</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 将文本记录转换为numpy矩阵</span>
<span class="token keyword">def</span> <span class="token function">file2matrix</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
    fr<span class="token operator">=</span>open<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>

    numberOfLines<span class="token operator">=</span>len<span class="token punctuation">(</span>fr<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    returnMat<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>numberOfLines<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 创建一个和文本一样形式的0矩阵</span>
    classLabelVector<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    fr<span class="token operator">=</span>open<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>

    index<span class="token operator">=</span><span class="token number">0</span>
    <span class="token keyword">for</span> line <span class="token keyword">in</span> fr<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        line<span class="token operator">=</span>line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        listFromLine<span class="token operator">=</span>line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span>
        returnMat<span class="token punctuation">[</span>index<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">=</span>listFromLine<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>
        classLabelVector<span class="token punctuation">.</span>append<span class="token punctuation">(</span>int<span class="token punctuation">(</span>listFromLine<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        index<span class="token operator">+=</span><span class="token number">1</span>
    <span class="token keyword">return</span> returnMat<span class="token punctuation">,</span>classLabelVector</code></pre>
<pre class=" language-python"><code class="language-python">datingDataMat<span class="token punctuation">,</span>datingLabels<span class="token operator">=</span>file2matrix<span class="token punctuation">(</span><span class="token string">'datingTestSet2.txt'</span><span class="token punctuation">)</span>
datingDataMat<span class="token punctuation">,</span>datingLabels<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span></code></pre>
<pre><code>(array([[4.0920000e+04, 8.3269760e+00, 9.5395200e-01],
        [1.4488000e+04, 7.1534690e+00, 1.6739040e+00],
        [2.6052000e+04, 1.4418710e+00, 8.0512400e-01],
        ...,
        [2.6575000e+04, 1.0650102e+01, 8.6662700e-01],
        [4.8111000e+04, 9.1345280e+00, 7.2804500e-01],
        [4.3757000e+04, 7.8826010e+00, 1.3324460e+00]]),
 [3, 2, 1, 1, 1, 1, 3, 3, 1, 3, 1, 1, 2, 1, 1, 1, 1, 1, 2, 3])</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 分析数据，使用Matplotlib创建散点图</span>
<span class="token keyword">import</span> matplotlib
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token comment" spellcheck="true"># mpl.rcParams['font.sans-serif'] = ['SimHei']  </span>
<span class="token comment" spellcheck="true"># mpl.rcParams['axes.unicode_minus'] = False  </span>
fig<span class="token operator">=</span>plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
ax<span class="token operator">=</span>fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span>

datingLabels <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>datingLabels<span class="token punctuation">)</span>

idx_1<span class="token operator">=</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>datingLabels<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>
p1<span class="token operator">=</span>ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>datingDataMat<span class="token punctuation">[</span>idx_1<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>datingDataMat<span class="token punctuation">[</span>idx_1<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">,</span>label<span class="token operator">=</span><span class="token string">'1'</span><span class="token punctuation">,</span>s<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
idx_2<span class="token operator">=</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>datingLabels<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span>
p2<span class="token operator">=</span>ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>datingDataMat<span class="token punctuation">[</span>idx_2<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>datingDataMat<span class="token punctuation">[</span>idx_2<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'g'</span><span class="token punctuation">,</span>label<span class="token operator">=</span><span class="token string">'1'</span><span class="token punctuation">,</span>s<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
idx_3<span class="token operator">=</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>datingLabels<span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span>
p3<span class="token operator">=</span>ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>datingDataMat<span class="token punctuation">[</span>idx_3<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>datingDataMat<span class="token punctuation">[</span>idx_3<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span>label<span class="token operator">=</span><span class="token string">'1'</span><span class="token punctuation">,</span>s<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># ax.scatter(datingDataMat[:,1],datingDataMat[:,2],15.0*np.array(datingLabels),15.0*np.array(datingLabels),c='yellow')</span>

plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span>u<span class="token string">'每年获取的飞行常客里程数'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span>u<span class="token string">'玩视频游戏所耗时间百分比'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">,</span>p3<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>u<span class="token string">'不喜欢'</span><span class="token punctuation">,</span> u<span class="token string">'魅力一般'</span><span class="token punctuation">,</span> u<span class="token string">'极具魅力'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> loc<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># ax.rc('font',family=['SeiHei'])</span>
<span class="token comment" spellcheck="true">#ax.legend((p1,p2,p3), (u'不喜欢', u'魅力一般', u'极具魅力'), loc=2, prop=zhfont)</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'SimHei'</span><span class="token punctuation">]</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p><img src="/KNN/Untitled_7_0.png" alt="png"></p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 归一化特征值</span>
<span class="token keyword">def</span> <span class="token function">autoNorm</span><span class="token punctuation">(</span>dataSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    minVals<span class="token operator">=</span>dataSet<span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 3列数据中的3个最小值</span>
    maxVals<span class="token operator">=</span>dataSet<span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 3列数据中的3个最大值</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>minVals<span class="token punctuation">)</span>

    ranges<span class="token operator">=</span>maxVals<span class="token operator">-</span>minVals
    normDateSet<span class="token operator">=</span>np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>np<span class="token punctuation">.</span>shape<span class="token punctuation">(</span>dataSet<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>normDateSet<span class="token punctuation">)</span>
    m<span class="token operator">=</span>dataSet<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># 行数1000</span>
    normDateSet<span class="token operator">=</span>dataSet<span class="token operator">-</span>np<span class="token punctuation">.</span>tile<span class="token punctuation">(</span>minVals<span class="token punctuation">,</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#dataSet减去同样格式的最小值组成的矩阵</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>normDateSet<span class="token punctuation">)</span>
    normDateSet<span class="token operator">=</span>normDateSet<span class="token operator">/</span>np<span class="token punctuation">.</span>tile<span class="token punctuation">(</span>ranges<span class="token punctuation">,</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> normDateSet<span class="token punctuation">,</span>ranges<span class="token punctuation">,</span>minVals</code></pre>
<p>normMat,ranges,minVals=autoNorm(datingDataMat)</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 分类器针对约会网站的测试代码</span>
<span class="token keyword">def</span> <span class="token function">datingClassTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    hoRatio<span class="token operator">=</span><span class="token number">0.5</span>
    datingDataMat<span class="token punctuation">,</span>datingLabels<span class="token operator">=</span>file2matrix<span class="token punctuation">(</span><span class="token string">'datingTestSet2.txt'</span><span class="token punctuation">)</span>
    normMat<span class="token punctuation">,</span>ranges<span class="token punctuation">,</span>minVals<span class="token operator">=</span>autoNorm<span class="token punctuation">(</span>datingDataMat<span class="token punctuation">)</span>
    m<span class="token operator">=</span>normMat<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    numTestVecs<span class="token operator">=</span>int<span class="token punctuation">(</span>m<span class="token operator">*</span>hoRatio<span class="token punctuation">)</span>
    errorCount<span class="token operator">=</span><span class="token number">0.0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>numTestVecs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        classifierResult<span class="token operator">=</span>classify0<span class="token punctuation">(</span>normDateSet<span class="token punctuation">)</span></code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://gongyanli.com/%E5%A6%82%E4%BD%95%E5%B0%86ipynb%E6%96%87%E4%BB%B6%E8%BD%AC%E6%8D%A2%E4%B8%BAhtml%EF%BC%8Cmarkdown%EF%BC%8Cpdf%E7%AD%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lilly">
      <meta itemprop="description" content="Up in the wind!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茉莉Python">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E5%A6%82%E4%BD%95%E5%B0%86ipynb%E6%96%87%E4%BB%B6%E8%BD%AC%E6%8D%A2%E4%B8%BAhtml%EF%BC%8Cmarkdown%EF%BC%8Cpdf%E7%AD%89/" class="post-title-link" itemprop="url">如何将ipynb文件转换为html，markdown，pdf等</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-09-09 22:25:54" itemprop="dateCreated datePublished" datetime="2018-09-09T22:25:54+08:00">2018-09-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-18 21:26:53" itemprop="dateModified" datetime="2020-09-18T21:26:53+08:00">2020-09-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7%E7%AF%87/" itemprop="url" rel="index"><span itemprop="name">工具篇</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7%E7%AF%87/Jupyter/" itemprop="url" rel="index"><span itemprop="name">Jupyter</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><pre><code>本文讲将jupyter notebook中的文件（xxx.ipynb）转换成html，md，pdf等格式呢。
如果使用下列命令有误的话，建议安装jupyter相关插件：
$ pip install jupyter_contrib_nbextensions</code></pre>
<h2 id="一-ipynb转为html格式"><a href="#一-ipynb转为html格式" class="headerlink" title="一.ipynb转为html格式"></a>一.ipynb转为html格式</h2><pre><code>$ jupyter nbconvert --to html notebook.ipynb

jupyter中提供了一些命令，可以对生成的html格式进行配置：
$ jupyter nbconvert --to html --template full notebook.ipynb

默认配置，提供完整的静态html格式，交互性更强。
$ jupyter nbconvert --to html --template basic notebook.ipynb
简化的html，用于嵌入网页、博客等，这不包括html标题。</code></pre>
<h2 id="二-ipynb转换为md格式"><a href="#二-ipynb转换为md格式" class="headerlink" title="二.ipynb转换为md格式"></a>二.ipynb转换为md格式</h2><pre><code>$ jupyter nbconvert --to markdown notebook.ipynb
简单的Markdown格式输出，cell单元不受影响，代码cell缩进4个空格。</code></pre>
<h2 id="三-ipynb转换为tex格式"><a href="#三-ipynb转换为tex格式" class="headerlink" title="三.ipynb转换为tex格式"></a>三.ipynb转换为tex格式</h2><pre><code>$ jupyter nbconvert --to letex notebook.ipynb

Letex导出格式，生成后缀名为NOTEBOOK_NAME.tex的文件。jupyter提供的额外模板配置为：
$ jupyter nbconvert --to letex -template article notebook.ipynb

默认配置，Latex文章。
$ jupyter nbconvert --to letex -template report notebook.ipynb

Latex报告，提供目录和章节。
$ jupyter nbconvert --to letex -template basic notebook.ipynb
最基本的Latex输出，经常用来自定义配置。</code></pre>
<h2 id="四-jupyter转换为pdf格式"><a href="#四-jupyter转换为pdf格式" class="headerlink" title="四.jupyter转换为pdf格式"></a>四.jupyter转换为pdf格式</h2><pre><code>$ jupyter nbconvert --to pdf notebook.ipynb

转换为pdf格式分模板配置与latex配置是一样的。但是直接转换为pdf格式经常会出现xelatex错误：
该错误提示没有安装xelatex。所以，我们需要提前安装xelatex，方法是安装texLive套装：

$ sudo apt-get install texlive-full
texlive-full的安装包有点大，约1G多。</code></pre>
<h2 id="五-简单的转换方法"><a href="#五-简单的转换方法" class="headerlink" title="五.简单的转换方法"></a>五.简单的转换方法</h2><pre><code>ipynb转换为html、md、pdf等格式，还有另一种更简单的方法：在jupyter notebook中，选择File-&gt;Download as，直接选择需要转换的格式就可以了。需要注意的是，转换为pdf格式之前，同样要保证已经安装了xelatex。</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://gongyanli.com/Mac-Matplotlib%E6%97%A0%E6%B3%95%E6%98%BE%E7%A4%BA%E4%B8%AD%E6%96%87%E7%9A%84%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lilly">
      <meta itemprop="description" content="Up in the wind!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茉莉Python">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Mac-Matplotlib%E6%97%A0%E6%B3%95%E6%98%BE%E7%A4%BA%E4%B8%AD%E6%96%87%E7%9A%84%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">matplotlib-1-问题记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-09-02 13:29:05" itemprop="dateCreated datePublished" datetime="2018-09-02T13:29:05+08:00">2018-09-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-18 17:07:42" itemprop="dateModified" datetime="2020-09-18T17:07:42+08:00">2020-09-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%92%8C%E6%8A%93%E5%8F%96/" itemprop="url" rel="index"><span itemprop="name">数据分析和抓取</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%92%8C%E6%8A%93%E5%8F%96/Matplotlib/" itemprop="url" rel="index"><span itemprop="name">Matplotlib</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、问题：matplotlib无法显示中文的问题"><a href="#一、问题：matplotlib无法显示中文的问题" class="headerlink" title="一、问题：matplotlib无法显示中文的问题"></a>一、问题：matplotlib无法显示中文的问题</h2><pre><code>网上找了好多种方法，显示中文的时候还是小框框，在我的Mac上就是不行。这是在我的Mac上可行的办法，希望对你也有用。</code></pre>
<h3 id="1、下载SimHei-ttf字体"><a href="#1、下载SimHei-ttf字体" class="headerlink" title="1、下载SimHei.ttf字体"></a>1、下载SimHei.ttf字体</h3><pre><code>http://www.fontpalace.com/font-details/SimHei/</code></pre>
<h3 id="2、解决办法"><a href="#2、解决办法" class="headerlink" title="2、解决办法"></a>2、解决办法</h3><pre><code>1.找到Matplotlib路径
$ python
&gt; import matplotlib
&gt; print(matplotlib.matplotlib_fname()) # 获得matplotlib包所在文件夹路径
/anaconda3/envs/tensorflow/lib/python3.6/site-packages/matplotlib/mpl-data/matplotlibrc

2.将下载的ttf文件拷贝到此目录下
$ cd /anaconda3/envs/tensorflow/lib/python3.6/site-packages/matplotlib/mpl-data/
$ cd fonts/ttf
$ cp ttf文件 . # 拷贝下载的ttf文件到此目录

3. 删除字体缓存文件
$ rm -rf ~/.matplotlib/*.cache

4. 字体参数设置
$ cd /anaconda3/envs/tensorflow/lib/python3.6/site-packages/matplotlib/mpl-data
$ vi matplotlibrc
font.family         : sans-serif 
font.sans-serif     : SimHei
axes.unicode_minus  : False # use unicode for the minus symbol
# 意思是知道字库族为 sans-serif，同时添加“SimHei”即宋体到字库族列表中，同时将找到axes.unicode_minus，将True改为False，作用就是解决负号’-‘显示为方块的问题

5. 字体显示
有中文出现的情况，需要 u&#39;内容&#39;，比如 plt.xlabel(u&#39;横坐标&#39;)
同时还需在开头添加代码行：#coding:utf-8

注意：
但是我走到这一步后运行，字体显示仍未小框框。提示：
【UserWarning: findfont: Font family [‘sans-serifs’] not found. Falling back to Bitstream Vera Sans】
说明还是没有找到字体，所以我进一步进行配置。

6.配置fontList.json
# 在ttflist文件添加&quot;SimHei&quot;字体集

$ cd /Users/apple/.matplotlib
$ vi fontList.json</code></pre>
<p><img src="http://p2lakvkq0.bkt.clouddn.com/matplotlib_fonts.png"><br>    图片红框中的ttf文件是我后加的，说明之前这个ttf文件不在其中，所以自然找不到这个字体。<br>    根据自己的位置在文件中添加自己的ttf文件<br>    添加如下配置（参考文件中的配置）：</p>
<pre><code>&#123;
  &quot;fname&quot;: &quot;/anaconda3/envs/tensorflow/lib/python3.6/site-packages/matplotlib/mpl-data/fonts/ttf/SimHei.ttf&quot;,
  &quot;name&quot;: &quot;SimHei&quot;,
  &quot;style&quot;: &quot;normal&quot;,
  &quot;variant&quot;: &quot;normal&quot;,
  &quot;weight&quot;: 400,
  &quot;stretch&quot;: &quot;normal&quot;,
  &quot;size&quot;: &quot;scalable&quot;,
  &quot;_class&quot;: &quot;FontEntry&quot;
&#125;,

之后重启项目，matplotlib即可显示中文字体了。</code></pre>
<h2 id="二、查看matplotlib支持的字体集"><a href="#二、查看matplotlib支持的字体集" class="headerlink" title="二、查看matplotlib支持的字体集"></a>二、查看matplotlib支持的字体集</h2><pre><code>$ python 
&gt; import matplotlib
&gt; xxx=sorted(f.name for f in matplotlib.font_manager.fontManager.ttflist)
&gt; for i in xxx:
          print(i)</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://gongyanli.com/Django-2-ModelForm%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lilly">
      <meta itemprop="description" content="Up in the wind!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茉莉Python">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Django-2-ModelForm%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">Django-2-ModelForm详解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-08-31 12:41:10" itemprop="dateCreated datePublished" datetime="2018-08-31T12:41:10+08:00">2018-08-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-18 13:42:46" itemprop="dateModified" datetime="2020-09-18T13:42:46+08:00">2020-09-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/Django/" itemprop="url" rel="index"><span itemprop="name">Django</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一-前言"><a href="#一-前言" class="headerlink" title="一.前言"></a>一.前言</h2><pre><code>ModelForm：功能是将Model和Form组合起来</code></pre>
<h2 id="二-ModelForm"><a href="#二-ModelForm" class="headerlink" title="二.ModelForm"></a>二.ModelForm</h2><pre><code>from django.forms import ModelForm # 导入ModelForm
from django.forms import fields
from .models import Book

class BookModelForm(forms.ModelForm):
class Meta:
     # 可以在这里单独定义字段的具体类型和属性，同Form;
     # 如果定义的字段在model中存在，则会覆盖；
     name=fields.CharField(required=True)

    model = Book

    # fields控制在前端显示的字段
    fields = [&#39;name&#39;, &#39;authors&#39;, &#39;publish_date&#39;]
    fields=&#39;__all__&#39;

    # labels控制在前端是否显示标题
     labels=&#123;
             &#39;name&#39;: &#39;用户名&#39;,   # &#39;name&#39;:&#39;&#39; 
         &#39;authors&#39;: &#39;作者&#39;,
         &#39;publish_date&#39;: &#39;日期&#39;,
     &#125;

    widgets = &#123;
        &#39;name&#39;: forms.TextInput(attrs=&#123;&#39;class&#39;: &quot;form-control&quot;&#125;),
        &#39;authors&#39;: forms.Select(attrs=&#123;&#39;class&#39;: &quot;form-control&quot;&#125;),
        &#39;publish_date&#39;: forms.DateInput(attrs=&#123;&#39;class&#39;: &quot;form-control&quot;,
                                               &#39;placeholder&#39;: &quot;YYYY-MM-DD&quot;&#125;)
    &#125;




 说明：

    model: 对应的数据库model

    fields: 选择字段列表；’all’是选择所有字段

    exclude: 排除字段列表

    widgets: 插件字典

    labels: 前端显示字段名

    help_texts：帮助提示信息

    error_messages: 自定义错误提示

    localized_fields: 本地化，如：根据不同时区显示数据</code></pre>
<h2 id="三-View"><a href="#三-View" class="headerlink" title="三.View"></a>三.View</h2><pre><code>class Index(TemplateView):
  template_name = &quot;index.html&quot;

  def get(self, request, *args, **kwargs):
      form = BookModelForm()    
      return self.render_to_response(context=&#123;&quot;form&quot;: form&#125;)

  def post(self,request):

      form = BookModelForm()

      # obj=model.Book.objects.get(id=1)
      #form=BookModelForm(request.POST,instance=obj)

     if form.is_valid():
         form.save()
         return redirect(&quot;home&quot;)

            # obj = form.save(commit=False)
            # obj.save()      # 保存单表信息
            # obj.save_m2m()  # 保存关联多对多信息
     return self.render_to_response(context=&#123;&quot;form&quot;: form&#125;)</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://gongyanli.com/iTerm2-sshpass-Mac%E4%B8%8B%E4%BD%BF%E7%94%A8iTerm2%E5%85%8D%E5%AF%86%E8%BF%9E%E6%8E%A5%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lilly">
      <meta itemprop="description" content="Up in the wind!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茉莉Python">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/iTerm2-sshpass-Mac%E4%B8%8B%E4%BD%BF%E7%94%A8iTerm2%E5%85%8D%E5%AF%86%E8%BF%9E%E6%8E%A5%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA/" class="post-title-link" itemprop="url">iTerm2+sshpass:Mac下使用iTerm2免密连接远程主机</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-08-31 11:37:49" itemprop="dateCreated datePublished" datetime="2018-08-31T11:37:49+08:00">2018-08-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-18 16:29:24" itemprop="dateModified" datetime="2020-09-18T16:29:24+08:00">2020-09-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7%E7%AF%87/" itemprop="url" rel="index"><span itemprop="name">工具篇</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7%E7%AF%87/ssh/" itemprop="url" rel="index"><span itemprop="name">ssh</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一-安装iTerm2"><a href="#一-安装iTerm2" class="headerlink" title="一.安装iTerm2"></a>一.安装iTerm2</h2><pre><code>不再介绍</code></pre>
<h2 id="二-安装sshpass"><a href="#二-安装sshpass" class="headerlink" title="二.安装sshpass"></a>二.安装sshpass</h2><pre><code>使用brew进行安装
$ brew install https://raw.githubusercontent.com/kadwanev/bigboybrew/master/Library/Formula/sshpass.rb
$ sshpass -h # 验证是否安装成功</code></pre>
<h2 id="三-设置免密"><a href="#三-设置免密" class="headerlink" title="三.设置免密"></a>三.设置免密</h2><pre><code>关键是Command模式格式：
/usr/local/bin/sshpass -p (密码) ssh -p (端口) (登录)@(服务器IP或者域名)</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://gongyanli.com/Mac%E4%B8%8B%E4%BD%BF%E7%94%A8iTerm2%E8%BF%9E%E6%8E%A5%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lilly">
      <meta itemprop="description" content="Up in the wind!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茉莉Python">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Mac%E4%B8%8B%E4%BD%BF%E7%94%A8iTerm2%E8%BF%9E%E6%8E%A5%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA/" class="post-title-link" itemprop="url">Mac下使用iTerm2连接远程主机</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-08-31 11:33:11" itemprop="dateCreated datePublished" datetime="2018-08-31T11:33:11+08:00">2018-08-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-18 16:34:21" itemprop="dateModified" datetime="2020-09-18T16:34:21+08:00">2020-09-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7%E7%AF%87/" itemprop="url" rel="index"><span itemprop="name">工具篇</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7%E7%AF%87/ssh/" itemprop="url" rel="index"><span itemprop="name">ssh</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h2><pre><code>1. 打开一个 iTerm2 窗口，选择菜单 profiles 中的 Open Profiles，然后选择 Edit Profiles 中创建一个新的 Profile，自己命名
2. 选择 command，输入 ssh -A -p xxx root@输入远程计算机的 IP 地址（xxx 表示端口）。
3. 然后选择这个新的 profile，New 一个 window 就可以连接远程服务器了。</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://gongyanli.com/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E8%B0%88Git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lilly">
      <meta itemprop="description" content="Up in the wind!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茉莉Python">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E8%B0%88Git/" class="post-title-link" itemprop="url">深入浅出谈Git</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-08-24 18:56:03" itemprop="dateCreated datePublished" datetime="2018-08-24T18:56:03+08:00">2018-08-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-18 16:26:06" itemprop="dateModified" datetime="2020-09-18T16:26:06+08:00">2020-09-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7%E7%AF%87/" itemprop="url" rel="index"><span itemprop="name">工具篇</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7%E7%AF%87/git/" itemprop="url" rel="index"><span itemprop="name">git</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一-Git配置"><a href="#一-Git配置" class="headerlink" title="一.Git配置"></a>一.Git配置</h2><pre><code>$ git config --global user.name &quot;Your Name&quot;
$ git config --global user.email &quot;email@example.com&quot;</code></pre>
<h2 id="二-Git初始化"><a href="#二-Git初始化" class="headerlink" title="二.Git初始化"></a>二.Git初始化</h2><pre><code>$ git init
$ git add .
$ git commit -m &quot;first commit&quot;
$ git push -u origin master</code></pre>
<h2 id="三-Git状态"><a href="#三-Git状态" class="headerlink" title="三.Git状态"></a>三.Git状态</h2><pre><code>$ git status
$ git diff readme.txt # 查看修改内容</code></pre>
<h2 id="四-Git时光机"><a href="#四-Git时光机" class="headerlink" title="四.Git时光机"></a>四.Git时光机</h2><h3 id="1-版本回退"><a href="#1-版本回退" class="headerlink" title="1.版本回退"></a>1.版本回退</h3><pre><code>$ git log # 查看最近到最远的提交日志
$ git log --pretty=online # 格式更清晰

# 在Git中，HEAD表示当前版本，上一个版本是HEAD^,上上一个版本是HEAD……^^，往上100个版本是HEAD~100

$ git reset --hard HEAD^ # 回退到上一个版本

$ git reset --hard 1094a # 1094a刚才的那个版本号，回退到未来的那个版本，前提是你的命令行窗口没有被关掉，版本号可以不写全

# 如果回退到某个版本，关掉了电脑，第二天后悔了，想恢复到新版本怎么办？
$ git relog # 记录你的每一次命令，此时可以找到你昨天的commit id是1094a

小结：
HEAD指向的版本就是当前版本，因此，Git允许我们在版本的历史之间穿梭，使用命令git reset --hard commit_id。
穿梭前，用git log可以查看提交历史，以便确定要回退到哪个版本。
要重返未来，用git reflog查看命令历史，以便确定要回到未来的哪个版本。</code></pre>
<h3 id="2-工作区（Working-Directory）和暂存区"><a href="#2-工作区（Working-Directory）和暂存区" class="headerlink" title="2.工作区（Working Directory）和暂存区"></a>2.工作区（Working Directory）和暂存区</h3><pre><code>工作区（Working Directory）:learngit
版本库（Repository）：隐藏目录.git
Git的版本库里存了很多东西，其中最重要的就是称为stage（或者叫index）的暂存区，还有Git为我们自动创建的第一个分支master，以及指向master的一个指针叫HEAD。</code></pre>
<p><img src="http://p2lakvkq0.bkt.clouddn.com/git1.png" alt="enter description here"></p>
<pre><code>把文件往Git版本库里添加的时候，是分两步执行的：
第一步是用git add把文件添加进去，实际上就是把文件修改添加到暂存区；
第二步是用git commit提交更改，实际上就是把暂存区的所有内容提交到当前分支。

因为我们创建Git版本库时，Git自动为我们创建了唯一一个master分支，所以，现在，git commit就是往master分支上提交更改。

你可以简单理解为，需要提交的文件修改通通放到暂存区，然后，一次性提交暂存区的所有修改。</code></pre>
<p><img src="http://p2lakvkq0.bkt.clouddn.com/git2.png" alt="enter description here"><br><img src="http://p2lakvkq0.bkt.clouddn.com/git3.png" alt="enter description here"></p>
<h3 id="3-管理修改"><a href="#3-管理修改" class="headerlink" title="3.管理修改"></a>3.管理修改</h3><pre><code>为什么Git比其他版本控制系统设计得优秀，因为Git跟踪并管理的是修改，而非文件。
$ git diff HEAD -- readme.txt # 查看工作区和版本库里最新版本区别</code></pre>
<h3 id="4-撤销修改"><a href="#4-撤销修改" class="headerlink" title="4.撤销修改"></a>4.撤销修改</h3><pre><code>$ git checkout -- readme.txt # 把文件在工作区的修改全部撤销掉
两种情况：
readme.txt自修改后还没有被放到暂存区，撤销修改就回到和版本库一模一样的状态；
readme.txt已经添加到暂存区去，又做了修改，撤销修改就回到添加到暂存区后的状态；
总之，就是让这个文件回到最近一次git commit或git add时的状态。
# --很重要，如果没有，则变成了切换分支命令

$ git add readme.txt # 已到暂存区，还未提交
$ git reset HEAD readme.txt # 把暂存区修改撤销掉（unstage），重新放回工作区
git reset命令既可以回退版本，也可以把暂存区的修改回退到工作区。当我们用HEAD时，表示最新的版本。

小结：
场景1：当你改乱了工作区某个文件的内容，想直接丢弃工作区的修改时，用命令git checkout -- file。
场景2：当你不但改乱了工作区某个文件的内容，还添加到了暂存区时，想丢弃修改，分两步，第一步用命令git reset HEAD &lt;file&gt;，就回到了场景1，第二步按场景1操作。
场景3：已经提交了不合适的修改到版本库时，想要撤销本次提交，参考版本回退一节，不过前提是没有推送到远程库。</code></pre>
<h3 id="5-删除文件"><a href="#5-删除文件" class="headerlink" title="5.删除文件"></a>5.删除文件</h3><pre><code>$ git add test.txt
$ git commit -m &quot;add&quot;
$ git rm test.txt # 从版本库中删除文件，再git commit提交
$ git commit -m &quot;delete&quot;
$ git checkout -- test.txt # 删除错了，从版本库恢复到误删的文件，恢复到最新版本
git checkout其实是用版本库里的版本替换工作区的版本，无论工作区是修改还是删除，都可以“一键还原”。
小结：
命令git rm用于删除一个文件。如果一个文件已经被提交到版本库，那么你永远不用担心误删，但是要小心，你只能恢复文件到最新版本，你会丢失最近一次提交后你修改的内容。</code></pre>
<h2 id="五-远程仓库"><a href="#五-远程仓库" class="headerlink" title="五.远程仓库"></a>五.远程仓库</h2><pre><code>本地Git仓库和GitHub仓库之间的传输是通过SSH加密的，所以需要进行设置：
1.创建SSH Key
$ ssh-keygen -t rsa -C &quot;youremail@example.com&quot;
$ cd ~/.ssh
私钥：id_rsa
共约：id_rsa.pub
2.登录GitHub，将公钥放进配置文件
为什么GitHub需要SSH Key呢？因为GitHub需要识别出你推送的提交确实是你推送的，而不是别人冒充的，而Git支持SSH协议，所以，GitHub只要知道了你的公钥，就可以确认只有你自己才能推送。</code></pre>
<h3 id="1-添加远程库"><a href="#1-添加远程库" class="headerlink" title="1.添加远程库"></a>1.添加远程库</h3><pre><code>在github上创建仓库
$ git remote add origin git@github.com:Gladysgong/learngit.git # 本地仓库与远程库关联，远程库叫做origin
$ git push -u origin master # 将本地库所有内容推送到远程库上
把本地库的内容推送到远程，用git push命令，实际上是把当前分支master推送到远程。
由于远程库是空的，我们第一次推送master分支时，加上了-u参数，Git不但会把本地的master分支内容推送的远程新的master分支，还会把本地的master分支和远程的master分支关联起来，在以后的推送或者拉取时就可以简化命令。

小结：
要关联一个远程库，使用命令git remote add origin git@server-name:path/repo-name.git；
关联后，使用命令git push -u origin master第一次推送master分支的所有内容；
此后，每次本地提交后，只要有必要，就可以使用命令git push origin master推送最新修改；</code></pre>
<h3 id="2-克隆远程库"><a href="#2-克隆远程库" class="headerlink" title="2.克隆远程库"></a>2.克隆远程库</h3><pre><code>$ git clone git@github.com:Gladysgong/gitskills.git
Git支持多种协议，包括https，但通过ssh支持的原生git协议速度最快</code></pre>
<h2 id="六-分支管理"><a href="#六-分支管理" class="headerlink" title="六.分支管理"></a>六.分支管理</h2><h3 id="1-创建与合并分支"><a href="#1-创建与合并分支" class="headerlink" title="1.创建与合并分支"></a>1.创建与合并分支</h3><pre><code>每次提交，Git都把它们串成一条时间线，这条时间线就是一个分支。
截止到目前，只有一条时间线，在Git里，这个分支叫主分支，即master分支。
HEAD严格来说不是指向提交，而是指向master，master才是指向提交的，所以，HEAD指向的就是当前分支。</code></pre>
<hr>
<pre><code>一开始的时候，master分支是一条线，Git用master指向最新的提交，再用HEAD指向master，就能确定当前分支，以及当前分支的提交点：</code></pre>
<p><img src="http://p2lakvkq0.bkt.clouddn.com/git4.png" alt="enter description here"></p>
<pre><code>每次提交，master分支都会向前移动一步，这样，随着你不断提交，master分支的线也越来越长</code></pre>
<hr>
<pre><code>当我们创建新的分支，例如dev时，Git新建了一个指针叫dev，指向master相同的提交，再把HEAD指向dev，就表示当前分支在dev上：</code></pre>
<p><img src="http://p2lakvkq0.bkt.clouddn.com/git5.png" alt="enter description here"></p>
<pre><code>Git创建一个分支很快，因为除了增加一个dev指针，改改HEAD的指向，工作区的文件都没有任何变化！
不过，从现在开始，对工作区的修改和提交就是针对dev分支了，比如新提交一次后，dev指针往前移动一步，而master指针不变：</code></pre>
<p><img src="http://p2lakvkq0.bkt.clouddn.com/git6.png" alt="enter description here"></p>
<pre><code>等我们在dev上的工作完成了，就可以把dev合并到master上。</code></pre>
<hr>
<pre><code>Git怎么合并呢？最简单的方法，就是直接把master指向dev的当前提交，就完成了合并：</code></pre>
<p><img src="http://p2lakvkq0.bkt.clouddn.com/git7.png" alt="enter description here"></p>
<pre><code>所以Git合并分支也很快！就改改指针，工作区内容也不变！
合并完分支后，甚至可以删除dev分支。删除dev分支就是把dev指针给删掉，删掉后，我们就剩下了一条master分支：</code></pre>
<p><img src="http://p2lakvkq0.bkt.clouddn.com/git8.png" alt="enter description here"></p>
<pre><code>实战：
$ git checkou -b dev # Switched to a new branch &#39;dev&#39;,-b参数表示创建并切换
$ git branch dev # 创建分支
$ git checkout dev # 切换分支
$ git branch # 查看当前分支
$ git checkout master # 切换回master分支
$ git merge dev # 将dev分支的工作成果合并到master分支
# 注意Fast-forward信息，Git告诉我们，这次合并是“快进模式”，也就是直接把master指向dev的当前提交，所以合并速度非常快。
$ git branch -d dev # 删除dev分支</code></pre>
<h3 id="2-解决冲突"><a href="#2-解决冲突" class="headerlink" title="2.解决冲突"></a>2.解决冲突</h3><pre><code>master分支和feature1分支各自分别都有新提交，变成了这样：</code></pre>
<p><img src="http://p2lakvkq0.bkt.clouddn.com/git9.png" alt="enter description here"></p>
<pre><code>此时，Git无法执行“快速合并”，只能试图把各自的修改合并起来，但这种合并就可能会有冲突。
$ git merge feature1
Auto-merging readme.txt # 合并失败
CONFLICT (content): Merge conflict in readme.txt
Automatic merge failed; fix conflicts and then commit the result.
$ git status # 可告诉我们冲突的文件

# 修改文件后再提交
$ git add readme.txt 
$ git commit -m &quot;conflict fixed&quot;</code></pre>
<p><img src="http://p2lakvkq0.bkt.clouddn.com/git10.png" alt="enter description here"></p>
<pre><code>$ git log --graph --pretty=online --abbrev-commit
*   cf810e4 (HEAD -&gt; master) conflict fixed
|\  
| * 14096d0 (feature1) AND simple
* | 5dc6824 &amp; simple
|/  
* b17d20e branch test
* d46f35e (origin/master) remove test.txt
* b84166e add test.txt
* 519219b git tracks changes
* e43a48b understand how stage works
* 1094adb append GPL
* e475afc add distributed
* eaadf4e wrote a readme file

$ git branch -d feature1

小结：
当Git无法自动合并分支时，就必须首先解决冲突。解决冲突后，再提交，合并完成。
解决冲突就是把Git合并失败的文件手动编辑为我们希望的内容，再提交。
用git log --graph命令可以看到分支合并图。</code></pre>
<h3 id="3-分支管理策略"><a href="#3-分支管理策略" class="headerlink" title="3.分支管理策略"></a>3.分支管理策略</h3><pre><code>合并分支时，如果Git会用Fast forward模式，但这种模式下，删除分支后，会丢掉分支信息。
如果要强制禁用Fast forward模式，Git就会在merge时生成一个新的commit，这样，从分支历史上就可以看出分支信息。
$ git merge --no-ff -m &quot;merge with no-ff&quot; dev # --no-ff参数表示禁用Fast forward
# 因为本次合并要创建一个新的commit，所以加上-m参数，把commit描述写进去。
$ git log --graph --pretty=oneline --abbrev-commit
*   e1e9c68 (HEAD -&gt; master) merge with no-ff
|\  
| * f52c633 (dev) add merge
|/  
*   cf810e4 conflict fixed
...</code></pre>
<p><img src="http://p2lakvkq0.bkt.clouddn.com/git11.png" alt="enter description here"></p>
<hr>
<pre><code>master分支应该是非常稳定的，也就是仅用来发布新版本，平时不能在上面干活；
那在哪干活呢？干活都在dev分支上，也就是说，dev分支是不稳定的，到某个时候，比如1.0版本发布时，再把dev分支合并到master上，在master分支发布1.0版本；
每个人都在dev分支上干活，每个人都有自己的分支，时不时地往dev分支上合并就可以了。
所以，团队合作的分支看起来就像这样：</code></pre>
<p><img src="http://p2lakvkq0.bkt.clouddn.com/git12.png" alt="enter description here"></p>
<pre><code>小结：
合并分支时，加上--no-ff参数就可以用普通模式合并，合并后的历史有分支，能看出来曾经做过合并，而fast forward合并就看不出来曾经做过合并。</code></pre>
<h3 id="4-bug分支"><a href="#4-bug分支" class="headerlink" title="4.bug分支"></a>4.bug分支</h3><pre><code>每个bug都可以通过一个新的临时分支来修复，修复后，合并分支，然后将临时分支删除。
$ git stash # 存储当前工作现场，等以后恢复工作继续工作
$ git stash list # 查看存储的工作现场
$ git stash apply # 恢复，但stash内容并不删除
$ git stash drop # 删除stash内容
$ git stash pop # 恢复，同时删除stash内容

# 可以多次stash，然后用git stash list查看，再恢复指定的stash
$ git stash apply stash@&#123;0&#125; # 恢复指定的stash

小结
修复bug时，我们会通过创建新的bug分支进行修复，然后合并，最后删除；
当手头工作没有完成时，先把工作现场git stash一下，然后去修复bug，修复后，再git stash pop，回到工作现场。</code></pre>
<h3 id="5-feature分支"><a href="#5-feature分支" class="headerlink" title="5.feature分支"></a>5.feature分支</h3><pre><code>添加一个新功能时，你肯定不希望因为一些实验性质的代码，把主分支搞乱了，所以，每添加一个新功能，最好新建一个feature分支，在上面开发，完成后，合并，最后，删除该feature分支。

一切顺利的话，feature分支和bug分支是类似的，合并，然后删除。
就在此时，接到上级命令，因经费不足，新功能必须取消！
$ git branch -d feature-vulcan # 销毁失败
# Git友情提醒，feature-vulcan分支还没有被合并，如果删除，将丢失掉修改，如果要强行删除，需要使用大写的-D参数。
$ git branch -D feature-vulcan # 强行删除
# 如果要丢弃一个没有被合并过的分支，可以通过git branch -D &lt;name&gt;强行删除。</code></pre>
<h3 id="6-多人协作"><a href="#6-多人协作" class="headerlink" title="6.多人协作"></a>6.多人协作</h3><pre><code>当你从远程仓库克隆时，实际上Git自动把本地的master分支和远程的master分支对应起来了，并且，远程仓库的默认名称是origin。
$ git remote # 查看远程库信息
$ git remote -v # 线上远程库更详细信息

origin  git@github.com:michaelliao/learngit.git (fetch)
origin  git@github.com:michaelliao/learngit.git (push)
显示了可以抓取和推送的origin的地址。如果没有推送权限，就看不到push的地址。</code></pre>
<h4 id="6-1-推送分支"><a href="#6-1-推送分支" class="headerlink" title="6.1 推送分支"></a>6.1 推送分支</h4><pre><code>推送分支，就是把该分支上的所有本地提交推送到远程库。推送时，要指定本地分支，这样，Git就会把该分支推送到远程库对应的远程分支上：

$ git push origin master
$ git push origin dev # 推送dev分支
但是，并不是一定要把本地分支往远程推送，那么，哪些分支需要推送，哪些不需要呢？

master分支是主分支，因此要时刻与远程同步；
dev分支是开发分支，团队所有成员都需要在上面工作，所以也需要与远程同步；
bug分支只用于在本地修复bug，就没必要推到远程了，除非老板要看看你每周到底修复了几个bug；
feature分支是否推到远程，取决于你是否和你的小伙伴合作在上面开发。

总之，就是在Git中，分支是否推送，视你的心情而定！</code></pre>
<h4 id="6-2-抓取分支"><a href="#6-2-抓取分支" class="headerlink" title="6.2 抓取分支"></a>6.2 抓取分支</h4><pre><code>当其他人从远程库clone时，默认情况下，你的小伙伴只能看到本地的master分支。
$ git branch 
* master

如果他要在dev分支上开发，就必须创建远程origin的dev分支到本地
$ git checkout -b dev origin/dev # 创建本地dev
$ git push origin dev 

# 但是两人都对同一文件做了修改并推送，此时就会有冲突
# Git已经提示我们，先用git pull把最新的提交从origin/dev抓下来，然后在本地合并，解决冲突，再推送
$ git pull # 失败，原因是没有指定本地dev分支与远程origin/dev分支的链接，所以此时需设置dev和origin/dev的链接
$ git branch --set-upstream-to=origin/dev dev # 设置origin/dev和dev的链接
$ git pull # 成功
# 这回git pull成功，但是合并有冲突，需要手动解决，解决的方法和分支管理中的解决冲突完全一样。解决后，提交，再push
$ git push origin dev</code></pre>
<h4 id="6-3-多人协作工作模式"><a href="#6-3-多人协作工作模式" class="headerlink" title="6.3 多人协作工作模式"></a>6.3 多人协作工作模式</h4><pre><code>首先，可以试图用git push origin &lt;branch-name&gt;推送自己的修改；
如果推送失败，则因为远程分支比你的本地更新，需要先用git pull试图合并；
如果合并有冲突，则解决冲突，并在本地提交；
没有冲突或者解决掉冲突后，再用git push origin &lt;branch-name&gt;推送就能成功！
如果git pull提示no tracking information，则说明本地分支和远程分支的链接关系没有创建，用命令git branch --set-upstream-to &lt;branch-name&gt; origin/&lt;branch-name&gt;</code></pre>
<h4 id="6-4-小结"><a href="#6-4-小结" class="headerlink" title="6.4 小结"></a>6.4 小结</h4><pre><code>查看远程库信息，使用git remote -v；
本地新建的分支如果不推送到远程，对其他人就是不可见的；
从本地推送分支，使用git push origin branch-name，如果推送失败，先用git pull抓取远程的新提交；
在本地创建和远程分支对应的分支，使用git checkout -b branch-name origin/branch-name，本地和远程分支的名称最好一致；
建立本地分支和远程分支的关联，使用git branch --set-upstream branch-name origin/branch-name；
从远程抓取分支，使用git pull，如果有冲突，要先处理冲突。</code></pre>
<h3 id="7-Rebase-变基"><a href="#7-Rebase-变基" class="headerlink" title="7.Rebase(变基)"></a>7.Rebase(变基)</h3><pre><code>多人在同一个分支上协作时，很容易出现冲突，冲突后再合并会使得分支很乱。
$ git rebase
rebase操作的特点：把分叉的提交历史“整理”成一条直线，看上去更直观。缺点是本地的分叉提交已经被修改过了。

小结：
rebase操作可以把本地未push的分叉提交历史整理成直线；
rebase的目的是使得我们在查看历史提交的变化时更容易，因为分叉的提交需要三方对比。</code></pre>
<h2 id="七-标签管理"><a href="#七-标签管理" class="headerlink" title="七.标签管理"></a>七.标签管理</h2><pre><code>发布一个版本时，我们通常先在版本库中打一个标签（tag），这样，就唯一确定了打标签时刻的版本。将来无论什么时候，取某个标签的版本，就是把那个打标签的时刻的历史版本取出来。所以，标签也是版本库的一个快照。
Git的标签虽然是版本库的快照，但其实它就是指向某个commit的指针（跟分支很像对不对？但是分支可以移动，标签不能移动），所以，创建和删除标签都是瞬间完成的。
所以，tag就是一个让人容易记住的有意义的名字，它跟某个commit绑在一起。</code></pre>
<h3 id="1-创建标签"><a href="#1-创建标签" class="headerlink" title="1.创建标签"></a>1.创建标签</h3><pre><code>$ git tag v1.0 # 创建标签
$ git tag # 查看所有标签
# 默认标签是打在最新提交的commit上

对过去的commit打标签
$ git log --pretty=online --abbrev-commit
$ git tag v0.9 f52c633

# 标签不是按时间顺序列出，而是按字母排序
$ git show v0.9 # 查看标签信息

$ git tag -a v0.1 -m &quot;version 0.1 released&quot; 1094adb # -a指定标签名，-m指定说明文字
注意：标签总是和某个commit挂钩。如果这个commit既出现在master分支，又出现在dev分支，那么在这两个分支上都可以看到这个标签
小结：
命令git tag &lt;tagname&gt;用于新建一个标签，默认为HEAD，也可以指定一个commit id；
命令git tag -a &lt;tagname&gt; -m &quot;blablabla...&quot;可以指定标签信息；
命令git tag可以查看所有标签。</code></pre>
<h3 id="2-操作标签"><a href="#2-操作标签" class="headerlink" title="2.操作标签"></a>2.操作标签</h3><pre><code>$ git tag -d v0.1 # 删除标签
因为创建的标签都只存储在本地，不会自动推送到远程。所以，打错的标签可以在本地安全删除。

如果要推送某个标签到远程，使用命令git push origin &lt;tagname&gt;：
$ git push origin v0.1 # 推送标签到远程
$ git push origin --tags # 一次性推送全部未推送到远程的本地标签

如果标签已推送到远程，删除远程标签麻烦一些，先删除本地，再删除远程
$ git tag -d v0.9
$ git push origin :refs/tags/v0.9 # 删除远程

小结：
命令git push origin &lt;tagname&gt;可以推送一个本地标签；
命令git push origin --tags可以推送全部未推送过的本地标签；
命令git tag -d &lt;tagname&gt;可以删除一个本地标签；
命令git push origin :refs/tags/&lt;tagname&gt;可以删除一个远程标签。</code></pre>
<h2 id="八-GitHub-Fork"><a href="#八-GitHub-Fork" class="headerlink" title="八.GitHub Fork"></a>八.GitHub Fork</h2><p><img src="http://p2lakvkq0.bkt.clouddn.com/git13.png" alt="enter description here">    </p>
<h2 id="九-码云"><a href="#九-码云" class="headerlink" title="九.码云"></a>九.码云</h2><pre><code> $ git remote add github git@github.com:Gladysgong/learngit.git
 $ git remote add gitee git@gitee.com:Gladysgong/learngit.git
 $ git remote -v 
 # 此时远程的名称不再叫origin，而是github和gitee
 $ git push github master # 推送到github
 $ git push gitee master # 推送到gitee</code></pre>
<p><img src="http://p2lakvkq0.bkt.clouddn.com/git14.png" alt="enter description here"></p>
<h2 id="十-自定义Git"><a href="#十-自定义Git" class="headerlink" title="十.自定义Git"></a>十.自定义Git</h2><pre><code>$ git config --global color.ui true # 让Git显示颜色</code></pre>
<h3 id="1-忽略特殊文件"><a href="#1-忽略特殊文件" class="headerlink" title="1.忽略特殊文件"></a>1.忽略特殊文件</h3><pre><code>在Git工作区根目录下创建一个特殊的.gitignore文件
https://github.com/github/gitignore
忽略文件原则：
忽略操作系统自动生成的文件，比如缩略图等；
忽略编译生成的中间文件、可执行文件等，也就是如果一个文件是通过另一个文件自动生成的，那自动生成的文件就没必要放进版本库，比如Java编译产生的.class文件；
忽略你自己的带有敏感信息的配置文件，比如存放口令的配置文件。

.gitignore
# Windows:
Thumbs.db
ehthumbs.db
Desktop.ini

# Python:
*.py[cod]
*.so
*.egg
*.egg-info
dist
build

# My configurations:
db.ini
deploy_key_rsa

有时候你想添加一个文件到Git，但发现添加不了，原因是这个文件被.gitignore忽略了
ggit add -f app.class # 强制添加文件
如果.gitignore写的有问题，需要找出哪个规则写错了
$ git check-ignore -v App.class # 检查哪个规则有错

小结：
忽略某些文件时，需要编写.gitignore；
gitignore文件本身要放到版本库里，并且可以对.gitignore做版本管理！</code></pre>
<h3 id="2-配置别名"><a href="#2-配置别名" class="headerlink" title="2.配置别名"></a>2.配置别名</h3><pre><code>$ git config --global alias.st status # 为status设置别名st

命令git reset HEAD file可以把暂存区的修改撤销掉（unstage），重新放回工作区。既然是一个unstage操作，就可以配置一个unstage别名：
$ git config --global alias.unstage &#39;reset HEAD&#39;

配置一个git last，让其显示最后一次提交信息：
$ git config --global alias.last &#39;log -l&#39;

git config --global alias.lg &quot;log --color --graph --pretty=format:&#39;%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset&#39; --abbrev-commit&quot;

配置文件：
配置Git的时候，加上--global是针对当前用户起作用的，如果不加，那只针对当前的仓库起作用。
$ cat .git/config # 仓库配置文件
$ cat .gitconfig # 当前用户的Git配置文件</code></pre>
<h3 id="3-搭建Git服务器"><a href="#3-搭建Git服务器" class="headerlink" title="3.搭建Git服务器"></a>3.搭建Git服务器</h3><pre><code>* 安装git
$ sudo apt-get install git 
* 创建一个git用户，用来运行git服务
$ sudo adduser git
* 创建证书登录
收集所有需要登录的用户的公钥，就是他们自己的id_rsa.pub文件，把所有公钥导入到/home/git/.ssh/authorized_keys文件里，一行一个。
* 初始化Git仓库
$ sudo git init --bare sample.git
$ sudo chown -R git:git sample.git
* 禁用shell登录
$ vi /etc/passwd
git:x:1001:1001:,,,:/home/git:/bin/bash
改为：
git:x:1001:1001:,,,:/home/git:/usr/bin/git-shell
git用户可以通过ssh使用git，但无法登录git
* 克隆远程仓库
$ git clone git@server:/srv/sample.git

管理公钥：
Gitosis:https://github.com/res0nat0r/gitosis
管理权限：
Gitolite:https://github.com/sitaramc/gitolite</code></pre>
<h2 id="十一-总结"><a href="#十一-总结" class="headerlink" title="十一.总结"></a>十一.总结</h2><pre><code>Git Cheat Sheet --百度网盘pub
Git官网：http://git-scm.com</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://gongyanli.com/CNN%E5%88%9D%E6%8E%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lilly">
      <meta itemprop="description" content="Up in the wind!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茉莉Python">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/CNN%E5%88%9D%E6%8E%A2/" class="post-title-link" itemprop="url">CNN初探</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-08-16 18:52:43" itemprop="dateCreated datePublished" datetime="2018-08-16T18:52:43+08:00">2018-08-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-18 17:01:21" itemprop="dateModified" datetime="2020-09-18T17:01:21+08:00">2020-09-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">机器学习和深度学习</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>转载地址：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/fydeblog/p/7450413.html">http://www.cnblogs.com/fydeblog/p/7450413.html</a></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这篇博客主要讲解卷积神经网络（CNN）的历史、模块、特点和架构等等</p>
<h2 id="1-CNN历史"><a href="#1-CNN历史" class="headerlink" title="1. CNN历史"></a>1. CNN历史</h2><ul>
<li>CNN最早可以追溯到1968Hubel和Wiesel的论文，这篇论文讲述猫和猴的视觉皮层含有对视野的小区域单独反应的神经元，如果眼睛没有移动，则视觉刺激影响单个神经元的视觉空间区域被称为其感受野（Receptive Field）。相邻细胞具有相似和重叠的感受野。感受野大小和位置在皮层之间系统地变化，形成完整的视觉空间图。这个为CNN的局部感知奠定了一个基础。</li>
<li>然后是1980年，神经感知机(neocognitron)的提出，标志了第一个初始的卷积神经网络的诞生，也是感受野概念在人工神经网络领域的首次应用，神经认知机将一个视觉模式分解成许多子模式（特征），然后进入分层递阶式相连的特征平面进行处理。</li>
<li>在然后1988年，时不变神经网络(Shift-invariant neural network)的提出，将卷积神经网络的功能进行了一次提高，使其能够在即使物体有位移或轻微变形的时候，也能完成识别。</li>
<li>卷积神经网络的前馈架构在神经抽象金字塔（Neural abstraction pyramid）中被横向和反馈连接扩展。所产生的复现卷积网络允许灵活地并入情景信息以迭代地解决局部模糊。与以前的模型相反，产生了最高分辨率的图像输出。</li>
<li>最后，2005出现了一篇GPU实现CNN的paper，标志了一种实现CNN更有效的方式，之后在2012年ImageNet大赛中CNN由于其高精确度脱颖而出，于是，深度学习正式进入人们的视野。<h2 id="2-CNN基本模块"><a href="#2-CNN基本模块" class="headerlink" title="2 CNN基本模块"></a>2 CNN基本模块</h2>CNN由输入和输出层以及多个隐藏层组成，隐藏层可分为卷积层，池化层、RELU层和全连通层。</li>
</ul>
<h3 id="2-1-输入层"><a href="#2-1-输入层" class="headerlink" title="2.1 输入层"></a>2.1 输入层</h3><p>CNN的输入一般是二维向量，可以有高度，比如，RGB图像</p>
<h3 id="2-2-卷积层"><a href="#2-2-卷积层" class="headerlink" title="2.2 卷积层"></a>2.2 卷积层</h3><p>卷积层是CNN的核心，层的参数由一组可学习的滤波器（filter）或内核（kernels）组成，它们具有小的感受野，延伸到输入容积的整个深度。 在前馈期间，每个滤波器对输入进行卷积，计算滤波器和输入之间的点积，并产生该滤波器的二维激活图（输入一般二维向量，但可能有高度（即RGB））。 简单来说，卷积层是用来对输入层进行卷积，提取更高层次的特征。</p>
<p>联想理解：</p>
<ul>
<li>可能上面的话语太拗口，这里讲一下卷积的作用，我最早接触卷积是在信号与系统这门课上。在信号与系统中，输入对一个系统的响应是等于输入信号e(x)与系统函数h(x)进行卷积，h(x)可以看作一个滤波器，它会对输入信号进行筛选，选择和它类似的信号，其他则过滤掉，相信学过的人有这个体会哈！</li>
<li>我们还可以想想数字图像处理（DIP）这门课，我们在提取图像的边缘特征时，用到的一个卷积核，名字叫sobel算子，它与图像进行卷积，就可以得到边缘，这个原因是有sobel算子与图像边缘的结构相似，所以才能提取出来，这个可能更容易理解卷积层的作用吧，但不同的是这里的卷积层参数未知，需要学习才能得到。<h3 id="2-3-池化层"><a href="#2-3-池化层" class="headerlink" title="2.3 池化层"></a>2.3 池化层</h3>池化层又称下采样，它的作用是减小数据处理量同时保留有用信息，它是怎么做到的呢？</li>
</ul>
<p>答：通常池化层是每邻域四个像素中的最大值变为一个像素（这就是下一讲要降的max_pooling），为什么可以这么做呢？这是因为卷积已经提取出特征，相邻区域的特征是类似，近乎不变，这是池化只是选出最能表征特征的像素，缩减了数据量，同时保留了特征，何乐而不为呢？池化层的作用可以描述为模糊图像，丢掉了一些不是那么重要的特征.</p>
<p>图形描述：</p>
<p><img src="https://images2017.cnblogs.com/blog/1078653/201708/1078653-20170829213953624-1445041755.png"></p>
<h3 id="2-4-RELU层"><a href="#2-4-RELU层" class="headerlink" title="2.4 RELU层"></a>2.4 RELU层</h3><p>这个RELU我们之前讲过，全名将修正线性单元，是神经元的激活函数，对输入值x的作用是max(0,x)，当然RELU只是一种选择，还有选Leak-Relu等等，一般都是用Relu！</p>
<h3 id="2-5-全连通层"><a href="#2-5-全连通层" class="headerlink" title="2.5 全连通层"></a>2.5 全连通层</h3><p>这个层就是一个常规的神经网络，它的作用是对经过多次卷积层和多次池化层所得出来的高级特征进行全连接（全连接就是常规神经网络的性质），算出最后的预测值。</p>
<h3 id="2-6-输出层"><a href="#2-6-输出层" class="headerlink" title="2.6 输出层"></a>2.6 输出层</h3><p>输出层就不用介绍了，就是对结果的预测值，一般会加一个softmax层。</p>
<h2 id="3-CNN的特点"><a href="#3-CNN的特点" class="headerlink" title="3. CNN的特点"></a>3. CNN的特点</h2><p>这里主要讨论CNN相比与传统的神经网络的不同之处，CNN主要有三大特色，分别是局部感知、权重共享和多卷积核</p>
<h3 id="3-1-局部感知"><a href="#3-1-局部感知" class="headerlink" title="3.1 局部感知"></a>3.1 局部感知</h3><p>局部感知就是我们上面说的感受野，实际上就是卷积核和图像卷积的时候，每次卷积核所覆盖的像素只是一小部分，是局部特征，所以说是局部感知。CNN是一个从局部到整体的过程（局部到整体的实现是在全连通层），而传统的神经网络是整体的过程。</p>
<p>图形描述：</p>
<p><img src="https://images2017.cnblogs.com/blog/1078653/201708/1078653-20170829214448858-1477823922.png"></p>
<h3 id="3-2-权重共享"><a href="#3-2-权重共享" class="headerlink" title="3.2 权重共享"></a>3.2 权重共享</h3><p>传统的神经网络的参数量是非常巨大的，比如1000X1000像素的图片，映射到和自己相同的大小，需要（1000X1000）的平方，也就是10的12次方，参数量太大了，而CNN除全连接层外，卷积层的参数完全取决于滤波器的设置大小，比如10x10的滤波器，这样只有100个参数，当然滤波器的个数不止一个，也就是下面要说的多卷积核。但与传统的神经网络相比，参数量小，计算量小。整个图片共享一组滤波器的参数。</p>
<h3 id="3-3-多卷积核"><a href="#3-3-多卷积核" class="headerlink" title="3.3 多卷积核"></a>3.3 多卷积核</h3><p>一种卷积核代表的是一种特征，为获得更多不同的特征集合，卷积层会有多个卷积核，生成不同的特征，这也是为什么卷积后的图片的高，每一个图片代表不同的特征。</p>
<h2 id="4-CNN实现架构"><a href="#4-CNN实现架构" class="headerlink" title="4. CNN实现架构"></a>4. CNN实现架构</h2><p>这里以LeNet-5(效果和paper)为例，一个典型的用来识别数字的卷积网络，当年美国大多数银行就是用它来识别支票上面的手写数字的。能够达到这种商用的地步，它的准确性可想而知。</p>
<p>LeNet-5主要有7层（不包括输入和输出），具体框架如图</p>
<p><img src="https://images2017.cnblogs.com/blog/1078653/201708/1078653-20170829214830265-1332499356.png"></p>
<p>流程：输入层——&gt;第一层卷积层——&gt;第一层池化层——&gt;第二层卷积层——&gt;第二层池化层——&gt;三层全连通层——&gt;输出层</p>
<p>详解：输入是一个2维的图片，大小32X32，经过第一层卷积层，得到了C1层的6个28X28的特征映射图，6个说明了第一层卷积层用了6个卷积核。这里卷积后大小变成28X28，这是因为卷积有两种，一种有填充，卷积后与原图像大小一样，另一种不带填充，卷积后结果与原图像相比，小了一些。然后经过第一层池化层，28X28变成了14X14，一般是每邻域四个像素中的最大值变为一个像素，相应图片的长和宽各缩小两倍。然后又经过一个卷积层，变成了C3层的16个10X10的特征映射图，然后又经过一个池化层，得到S4层的16个5X5的特征映射，然后将这16个5X5的特征映射送到3层的常规神经网络，得出最后的结果。</p>
<p>总结：我们可以这样想，前面的卷积层和池化层是为了提取输入的高级特征，送到全连通层的输入，然后训练出最后的结果。</p>
<h2 id="5-dropout"><a href="#5-dropout" class="headerlink" title="5.dropout"></a>5.dropout</h2><p>dropout是一种正则化的方法，应用在CNN中，主要解决CNN过拟合的问题。</p>
<p>怎么理解这个东西呢，首先我们要知道为什么过拟合？这是因为神经网络的神经元过多，参数过多，导致训练集拟合得太好了，为此，我们想dropout(丢掉)一些神经元，让它不产生影响。</p>
<p>具体做法:在每个隐藏层的输入进行一个概率判决，比如我们设置概率为0.5（通常命名为keep_prob）,根据0.5，我们生成一个跟隐藏层神经元个数的向量，true:false的比例是1：1（因为keep_prob=0.5），与隐藏层的输入进行相乘，那么会有一半隐藏层的神经元被丢掉，不起作用，整个网络变得简单了，就会从过拟合过渡到just right 。这是组合派的说法，andrew也是这么讲的，文末链接中还有一派噪声派的说法，也很有意思，可以看看！</p>
<p>图形理解（这个keep_prob等于0.4，即2/5）：</p>
<p><img src="https://images2017.cnblogs.com/blog/1078653/201708/1078653-20170830115048327-2007463236.png"></p>
<h2 id="6-结尾"><a href="#6-结尾" class="headerlink" title="6.结尾"></a>6.结尾</h2><p>CNN初探到此结束，当然，这是一个非常强大的算法，还需细细思考，体会其中更精华的东西！最后，由于笔者能力有限，如果错误，还请不吝指教！</p>
<p>在这里说一句，吴恩达的deeplearning.ai正式在网易云上线，全免费，非常值得观看哦！点开<a target="_blank" rel="noopener" href="http://mooc.study.163.com/smartSpec/detail/1001319001.htm">链接</a>即可观看！</p>
<p>参考</p>
<p>[1] <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Convolutional_neural_network">https://en.wikipedia.org/wiki/Convolutional_neural_network</a></p>
<p>[2] [<a target="_blank" rel="noopener" href="http://blog.csdn.net/zouxy09/article/details/8781543]">http://blog.csdn.net/zouxy09/article/details/8781543]</a>(<a href="http://blog.csdn.n[3]">http://blog.csdn.n[3]</a> <a target="_blank" rel="noopener" href="http://dataunion.org/11692.htmlet/zouxy09/article/details/8781543">http://dataunion.org/11692.htmlet/zouxy09/article/details/8781543</a>)</p>
<p>[3] <a target="_blank" rel="noopener" href="http://dataunion.org/11692.html">http://dataunion.org/11692.html</a></p>
<p>[4] <a target="_blank" rel="noopener" href="http://blog.csdn.net/stdcoutzyx/article/details/49022443">http://blog.csdn.net/stdcoutzyx/article/details/49022443</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://gongyanli.com/MySql-1-%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lilly">
      <meta itemprop="description" content="Up in the wind!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="茉莉Python">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/MySql-1-%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/" class="post-title-link" itemprop="url">MySql-1-错误记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-08-15 13:17:25" itemprop="dateCreated datePublished" datetime="2018-08-15T13:17:25+08:00">2018-08-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-18 21:41:07" itemprop="dateModified" datetime="2020-09-18T21:41:07+08:00">2020-09-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/MySql/" itemprop="url" rel="index"><span itemprop="name">MySql</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一-MySql-server-has-gone-away"><a href="#一-MySql-server-has-gone-away" class="headerlink" title="一.MySql server has gone away"></a>一.MySql server has gone away</h2><h3 id="1-原因"><a href="#1-原因" class="headerlink" title="1.原因"></a>1.原因</h3><pre><code>Mysql server服务器连接超时，并且关闭了与客户端的连接导致的；
默认情况下，如果在8小时没有对mysql进行查询请求的话，服务器就会自动断开连接。

发送给服务器的查询是错误的或者传送的数据太大；</code></pre>
<h3 id="2-解决方法"><a href="#2-解决方法" class="headerlink" title="2.解决方法"></a>2.解决方法</h3><pre><code>修改全局变量 wait_timeout和interactive_timeout两个变量的值
$ mysql -u root -p
$ mysql&gt;show variables like &#39;%timeout&#39;;
$ mysql&gt;set global wait_timeout = 2880000;
$ mysql&gt;set global interactive_timeout = 2880000;

interactive_timeout：交互式客户端连接的超时时间。
wait_timeout：是非交互式的超时时间。
client_interactive：运行mysql server 在交互式超时时间interactive_timeout（而不是wait_timeout）时间之后断开连接。

修改变量max_allowed_packet的大小
$ mysql&gt; set global max_allowed_packet = 64M;</code></pre>
<h2 id="二-’latin-1’-codec-can’t-encode-character"><a href="#二-’latin-1’-codec-can’t-encode-character" class="headerlink" title="二.’latin-1’ codec can’t encode character"></a>二.’latin-1’ codec can’t encode character</h2><h3 id="1-原因-1"><a href="#1-原因-1" class="headerlink" title="1.原因"></a>1.原因</h3><pre><code>pymysql 正常情况下会尝试将所有的内容转为latin1字符集处理</code></pre>
<h3 id="2-解决方法-1"><a href="#2-解决方法-1" class="headerlink" title="2.解决方法"></a>2.解决方法</h3><pre><code>设置连接和游标的charset为你所希望的编码，如utf8；
db = pymysql.connect(&quot;localhost&quot;,&quot;root&quot;,&quot;00000000&quot;,&quot;TESTDB&quot; ,use_unicode=True, charset=&quot;utf8&quot;)
注意：如果charset=&quot;utf-8&quot;也会报错，错误信息为【AttributeError: &#39;NoneType&#39; object has no attribute &#39;encoding&#39;】
可以看出是编码格式的问题，原来connect中的charset是&quot;utf8&quot;，而不是&quot;utf-8&quot;。同时port的需要number而不是string。</code></pre>
<h2 id="三-ERROR-1045-28000-Access-denied-for-user-‘root’-’localhost’-using-password-YES"><a href="#三-ERROR-1045-28000-Access-denied-for-user-‘root’-’localhost’-using-password-YES" class="headerlink" title="三.ERROR 1045 (28000): Access denied for user ‘root’@’localhost’ (using password: YES)"></a>三.ERROR 1045 (28000): Access denied for user ‘root’@’localhost’ (using password: YES)</h2><pre><code>mac解决办法：
$ sudo cd /usr/local/mysql/data
$ rm -rf ib_logfile0
$ rm -rf ib_logfile1
停止mysql服务；
$ cd /usr/local/mysql/bin/
$ sudo su
$ ./mysqld_safe --skip-grant-tables &amp; # 禁止mysql验证功能
# 回车后mysql会自动重启
$ ./mysql
&gt; FLUSH PRIVILEGES; 
&gt; ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;新密码&#39;; </code></pre>
<h2 id="四-2059-Authentication-plugin-‘caching-sha2-password’-cannot-be-loaded-dlopen-Frameworks-caching-sha2-password-so-2-image-not-found"><a href="#四-2059-Authentication-plugin-‘caching-sha2-password’-cannot-be-loaded-dlopen-Frameworks-caching-sha2-password-so-2-image-not-found" class="headerlink" title="四.2059 - Authentication plugin ‘caching_sha2_password’ cannot be loaded: dlopen(../Frameworks/caching_sha2_password.so, 2): image not found"></a>四.2059 - Authentication plugin ‘caching_sha2_password’ cannot be loaded: dlopen(../Frameworks/caching_sha2_password.so, 2): image not found</h2><pre><code>mac解决办法：
$ mysql -u root -p
&gt; ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED WITH mysql_native_password BY &#39;新密码&#39;;</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Lilly</p>
  <div class="site-description" itemprop="description">Up in the wind!</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">135</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">45</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lilly</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
